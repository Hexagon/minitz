

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      minitz - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <link id="google-font" href="https://fonts.googleapis.com/css?family=Roboto+Mono|Cutive+Mono|Roboto:300,400,700" rel="stylesheet">
  <link type="text/css" rel="stylesheet" href="styles/highlight-themes/current.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  <link type="text/css" rel="stylesheet" href="styles/collapsible.css">
  <link type="text/css" rel="stylesheet" href="styles/style-switcher.css">
  <link type="text/css" rel="stylesheet" href="styles/selectric.css">
  
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
  <script src="https://embed.runkit.com"></script>
  <style id="style-switcher-styles">
    nav {
        background: #282c34;
    }
    .hljs {
        background: #1d2027;
    }
    .nav-container > ul > li.active a {
        color: #dcdcdc;
    }
    .nav-container > ul > li.active a:hover {
        color: #f78200;
    }
    .nav-container > ul > li.active ul {
        border-color: #f78200;
    }
    h4.name {
        color: #f78200;
    }
    .params > div > code, .params > div > em {
        color: #f78200;
    }
    a, a:active {
        color: #f78200;
    }
    .hljs-doctag, .hljs-keyword, .hljs-formula {
        color: #f78200;
    }
    nav ul a:hover, nav ul a:active {
        color: #f78200;
    }
  </style>
</head>

<body>
  <header class="header-fixed">
      <h1>
        <a href="index.html" title="modernTemplate.title">
            
            minitz
        </a>
      </h1>
      <div class="center-header">
          <ul>
            
          </ul>
      </div>
      <div class="right-header">
           
                <a href="https://github.com/hexagon/minitz" title="View it on Github" style="">
                    <i class="fab fa-github-alt"></i>
                </a>
           
                <a href="https://www.npmjs.com/package/minitz" title="View it on NPM" style="font-size: 19px">
                    <i class="fas fa-exclamation-triangle"></i>
                </a>
           
      </div>
  </header>

  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <nav>
    <div id="menu-container" class="scrollbar-inner">
        <div class="nav-container">
            <h3 id="global-nav"><a href="global.html">Global</a></h3>
        </div>
    </div>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        minitz.js
      </h1>
    

    
      

<section>
  <article>
    <pre class="prettyprint source linenums"><code>/* ------------------------------------------------------------------------------------

	minitz - 2.0.1 - MIT License - Hexagon &lt;hexagon@56k.guru>

	------------------------------------------------------------------------------------

	License:

	Copyright (c) 2022 Hexagon &lt;hexagon@56k.guru>

	Permission is hereby granted, free of charge, to any person obtaining a copy
	of this software and associated documentation files (the "Software"), to deal
	in the Software without restriction, including without limitation the rights
	to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	copies of the Software, and to permit persons to whom the Software is
	furnished to do so, subject to the following conditions:
	The above copyright notice and this permission notice shall be included in
	all copies or substantial portions of the Software.
	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
	AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
	THE SOFTWARE.

  ------------------------------------------------------------------------------------  */
  
/**
 * @typedef {Object} TimePoint
 * @property {Number} year - 1970--
 * @property {Number} month - 1-12
 * @property {Number} day - 1-31
 * @property {Number} hour - 0-24
 * @property {Number} minute - 0-60
 * @property {Number} second - 0-60
 * @property {string} timezone - Time zone in IANA database format 'Europe/Stockholm'
 */

/*
 * Converts a date/time from a specific timezone to a normal date object with system local time
 *
 * Shortcut for minitz.fromTZ(minitz.tp(...));
 * 
 * @public
 * 
 * @param {Number} year - 1970--
 * @param {Number} month - 1-12
 * @param {Number} day - 1-31
 * @param {Number} hour - 0-24
 * @param {Number} minute - 0-60
 * @param {Number} second - 0-60
 * @param {string} timezone - Time zone in IANA database format 'Europe/Stockholm'
 * @param {boolean} [throwOnInvalidTime] - Default is to return adjusted time if input time is during an DST switch. 
 *										E.g. assume 01:01:01 if input is 00:01:01 but time actually 
 *										skips from 23:59:59 to 01:00:00. Setting this flag makes the library throw instead.
 * @returns {date} - Normal date object with correct UTC and system local time
 * 
*/
function minitz(year, month, day, hour, minute, second, timezone, throwOnInvalidTime) {
	return minitz.fromTZ(minitz.tp(year, month, day, hour, minute, second, timezone), throwOnInvalidTime);
}

/**
 * Converts a date/time from a specific timezone to a normal date object with system local time
 * 
 * @public
 * 
 * @param {string} localTimeString - ISO8601 formatted local time string, non UTC
 * @param {string} timezone - Time zone in IANA database format 'Europe/Stockholm'
 * @param {boolean} [throwOnInvalidTime] - Default is to return adjusted time if input time is during an DST switch. 
 *										E.g. assume 01:01:01 if input is 00:01:01 but time actually 
 *										skips from 23:59:59 to 01:00:00. Setting this flag to true makes the library throw instead.
 * @returns {date} - Normal date object
 */
minitz.fromTZISO = function(localTimeString, timezone, throwOnInvalidTime) {
	return minitz.fromTZ(parseISOLocal(localTimeString, timezone), throwOnInvalidTime);
};

/**
 * Converts a date/time from a specific timezone to a normal date object with system local time
 * 
 * @public
 * 
 * @param {TimePoint} date - Object with specified timezone
 * @param {boolean} [throwOnInvalidTime] - Default is to return adjusted time if input time is during an DST switch. 
 *										E.g. assume 01:01:01 if input is 00:01:01 but time actually 
 *										skips from 23:59:59 to 01:00:00. Setting this flag to true makes the library throw instead.
 * @returns {date} - Normal date object
 */
minitz.fromTZ = function(timePoint, throwOnInvalidTime) {
	
	const 

		// Construct a faux Date object with UTC date/time set to local date/time in source timezone
		inputDate = new Date(Date.UTC(
			timePoint.year,
			timePoint.month - 1,
			timePoint.day,
			timePoint.hour,
			timePoint.minute,
			timePoint.second
		)),

		// Get offset between UTC and source timezone
		offset = getTimezoneOffset(timePoint.timezone, inputDate),

		// Remove offset from inputDate to hopefully get a true date object
		guessedLocalDate = new Date(inputDate.getTime() - offset),

		// Get offset between UTC and guessed time in target timezone
		guessedInputDateOffset = getTimezoneOffset(timePoint.timezone, guessedLocalDate);

	// If offset between guessed true date object and UTC matches initial calculation, the guess
	// were spot on
	if ((guessedInputDateOffset - offset) === 0) {
		return guessedLocalDate;
	} else {
		// Not quite there yet, make a second try on guessing local time, adjust by the offset indicated by previous guess
		// Try recreating input time again
		// Then calculate and check offset again
		const 
			guessedLocalDate2 = new Date(inputDate.getTime() - guessedInputDateOffset),
			guessedInputDateOffset2 = getTimezoneOffset(timePoint.timezone, guessedLocalDate2);
		if ((guessedInputDateOffset2 - guessedInputDateOffset) === 0) {
			// All good, return local time
			return guessedLocalDate2;
		} else if (!throwOnInvalidTime) {
			// This guess wasn't spot on either, we're most probably dealing with a DST transition
			// - return the local time adjusted by _initial_ offset
			return guessedLocalDate;
		} else {
			// Input time is invalid, and the library is instructed to throw, so let's do it
			throw new Error("Invalid date passed to fromTZ()");
		}
	}
};

/**
 * Converts a date to a specific time zone and return a object containing year, month, 
 * day, hour, (...) and timezone used for conversion
 * 
 * **Please note**: If you just want to _display_ date/time in another 
 * time zone, use vanilla JS. See example below.
 * 
 * @public
 * 
 * @param {date} date - Input date
 * @param {string} [tzString] - Timezone string in Europe/Stockholm format
 * 
 * @returns {TimePoint}
 * 
 * @example &lt;caption>Example using minitz:&lt;/caption>
 * let normalDate = new Date(); // d is a normal Date instance, with local timezone and correct utc representation
 * 
 * tzDate = minitz.toTZ(d, 'America/New_York');
 * 
 * // Will result in the following object:
 * // {
 * //  year: 2022,
 * //  month: 9,
 * //  day: 28,
 * //  hour: 13,
 * //  minute: 28,
 * //  second: 28,
 * //  timezone: "America/New_York"
 * // }
 * 
 * @example &lt;caption>Example using vanilla js:&lt;/caption>
 * console.log(
 *	// Display current time in America/New_York, using sv-SE locale
 *	new Date().toLocaleTimeString("sv-SE", { timeZone: "America/New_York" }),
 * );
 * 
 */
minitz.toTZ = function (date, tzString) {
	const target = new Date(date.toLocaleString("sv-SE", {timeZone: tzString}));
	return {
		year: target.getFullYear(),
		month: target.getMonth() + 1,
		day: target.getDate(),
		hour: target.getHours(),
		minute: target.getMinutes(),
		second: target.getSeconds(),
		timezone: tzString
	};
};

/*
 * Convenience function wich return a TimePoint object for later use by fromTZ
 *
 * @public
 * 
 * @param {Number} year - 1970--
 * @param {Number} month - 1-12
 * @param {Number} day - 1-31
 * @param {Number} hour - 0-24
 * @param {Number} minute - 0-60
 * @param {Number} second - 0-60
 * @param {string} timezone - Time zone in format 'Europe/Stockholm'
 * 
 * @returns {TimePoint}
 * 
*/
minitz.tp = (y,m,d,h,i,s,t) => { return { year: y, month: m, day: d, hour: h, minute: i, second: s, timezone: t }; };

/**
 * Helper function that return the current UTC offset (in ms) for a specific timezone, and a specific point in time
 * 
 * @private
 * 
 * @param {timeZone} string - Target time zone in IANA database format 'Europe/Stockholm'
 * @param {date} [date] - Point in time to use as base for offset calculation
 * 
 * @returns {number} - Offset in ms between UTC and timeZone
 */
const getTimezoneOffset = (timeZone, date = new Date()) => {
	const tz = date.toLocaleString("en", {timeZone, timeStyle: "long"}).split(" ").slice(-1)[0];
	const dateString = date.toString();
	return Date.parse(`${dateString} UTC`) - Date.parse(`${dateString} ${tz}`);
};


/**
 * Helper function that takes a ISO8001 local date time string and creates a Date object. Throws on failure. Throws on UTC-flag.
 * 
 * @private
 * 
 * @param {string} dateTimeString - an ISO 8601 format date and time string
 *					  with all components, e.g. 2015-11-24T19:40:00
 * @returns {TimePoint} - TimePoint instance from parsing the string
 */
const parseISOLocal = function (dateTimeString, timezone) {
	const dateTimeStringSplit = dateTimeString.split(/\D/);

	// Check for completeness
	if (dateTimeStringSplit.length &lt; 6) {
		throw new Error("minitz: Incomplete ISO8601 passed to parser.");
	}

	const
		year = parseInt(dateTimeStringSplit[0], 10),
		month = parseInt(dateTimeStringSplit[1], 10),
		day = parseInt(dateTimeStringSplit[2], 10),
		hour = parseInt(dateTimeStringSplit[3], 10),
		minute = parseInt(dateTimeStringSplit[4], 10),
		second = parseInt(dateTimeStringSplit[5], 10);

	// Check parts for numeric
	if( isNaN(year) || isNaN(month) || isNaN(day) || isNaN(hour) || isNaN(minute) || isNaN(second) ) {
		throw new Error("minitz: Could not parse ISO8601 string.");
	} else {
		// Check for UTC flag
		if ((dateTimeString.indexOf("Z") > 0)) {
			throw new Error("minitz: Refuses to parse ISO8601 string with UTC-flag, can only handle local time.");
		} else {
			// Handle date as local time, and convert from specified time zone
			// Note: Date alreadu validated by the UTC-parsing
			return minitz.tp(year, month, day, hour, minute, second, timezone);
		}
	}
};

minitz.minitz = minitz;

export default minitz;
export { minitz };</code></pre>
  </article>
</section>

    



  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a>
  </footer>

    

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>
  <script src="scripts/scrollbar.js"></script>
  <script src="scripts/collapsible.js"></script>
  <script src="scripts/jquery.selectric.min.js"></script>
  <script src="scripts/clipboard.min.js"></script>

  <script>hljs.initHighlightingOnLoad();</script>

  
  <script>
      $(function () {
          $('#menu-container').scrollbar();

          
      });
    </script>
</body>
</html>
